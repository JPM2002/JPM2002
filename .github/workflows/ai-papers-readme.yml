name: SOTA Papers → README

on:
  workflow_dispatch:
    inputs:
      search_query:
        description: >-
          Free-text query for arXiv (matched in title/abstract/authors via all:).
          Use quotes for phrases and OR/AND to combine terms.
          Examples:
          "computer vision" OR diffusion,
          ("vision-language" OR VLM) AND retrieval,
          ("large language model" OR LLM) AND NOT survey
        required: false
      arxiv_categories:
        description: >-
          Comma-separated arXiv subject codes to restrict results (no spaces).
          Common: cs.CV (Vision), cs.CL (NLP), cs.LG (ML), cs.AI (AI), stat.ML (Stats ML).
          Examples: cs.CV  •  cs.CL,cs.LG  •  cs.CV,cs.CL,cs.LG
        required: false
      days_back:
        description: >-
          How many days back to include (UTC window; the cron runs daily).
          Smaller = fresher. Examples: 1 (today), 2 (last 48h), 7 (last week).
        required: false
      max_papers:
        description: >-
          Maximum number of papers to render in the README (after filtering by time/category).
          Examples: 3 (compact showcase), 10 (default), 20 (broader sweep).
        required: false
  schedule:
    - cron: "5 6 * * *"  # daily at 06:05 UTC

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Show files (debug)
        run: |
          echo "PWD=$(pwd)"
          ls -la
          echo "---- .github/scripts ----"
          ls -la .github/scripts || true

      - name: Verify script exists
        run: |
          test -f .github/scripts/fetch_papers.py || (echo "Missing .github/scripts/fetch_papers.py" && exit 1)

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install feedparser requests python-dateutil

      - name: Run fetch script
        env:
          SEARCH_QUERY: ${{ github.event.inputs.search_query || vars.SOTA_SEARCH_QUERY || 'diffusion OR "large language model" OR "vision-language" OR reinforcement learning' }}
          ARXIV_CATEGORIES: ${{ github.event.inputs.arxiv_categories || vars.SOTA_ARXIV_CATEGORIES || 'cs.LG,cs.AI,cs.CV,cs.CL,stat.ML' }}
          DAYS_BACK: ${{ github.event.inputs.days_back || vars.SOTA_DAYS_BACK || '2' }}
          MAX_PAPERS: ${{ github.event.inputs.max_papers || vars.SOTA_MAX_PAPERS || '10' }}
          TW_BEARER: ${{ secrets.TW_BEARER }}
          TW_ACCOUNTS: ${{ vars.SOTA_TW_ACCOUNTS }}
        run: |
          python .github/scripts/fetch_papers.py

      - name: Commit & push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore(readme): refresh SOTA papers list"
          file_pattern: README.md
